// ==UserScript==
// @name        Better Gatry
// @description Make Gatry great.
// @match       *://gatry.com/*
// ==/UserScript==

{const t="0.0.3";console.log("%c%s","background:#ff3375;color:#ffffff","   ___   _ _____ _____   __   \n  / __| /_\\_   _| _ \\ \\ / /   \n | (_ |/ _ \\| | |   /\\ V /    \n  \\___/_/ \\_\\_| |_|_\\ |_|     \n                              "),console.log("%c%s","color:#ff3375",`      ...but better! (v${t})`);const e={gatry:"admin"};try{fetch("https://cdn.jsdelivr.net/gh/Gataquadrada/better-gatry@latest/verified-users.json").then((t=>{t.json().then((t=>{t.users.forEach((t=>{"gatry"!==t.user&&(e[t.user]=t.badge)}))}))}))}catch(t){console.log("Not possible to use the fetch() API...")}const o={helped:!1,darkmode:!0,users:[]},n='<style id="bttg-dark-mode">\n\t\t:root{\n\t\t\t--bttg-color-bg: #222831;\n\t\t\t--bttg-color-fg: #393E46;\n\t\t\t--bttg-color-bc: #343a40;\n\t\t\t--bttg-color-fc: #cccccc;\n\t\t}\n\t\t:root.bttg-dark-mode body{\n\t\t\t--fancybox-content-bg: var(--bttg-color-fg);\n\t\t\t--fancybox-content-color: var(--bttg-color-fc);\n\t\t}\n\t\t.bttg-btn-dark-mode{\n\t\t\tbackground: #f27474;\n\t\t}\n\t\t.bttg-dark-mode .bttg-btn-dark-mode{\n\t\t\tbackground: #495057;\n\t\t}\n\t\t.bttg-dark-mode .bttg-btn-dark-mode .bttg-is-sun,\n\t\t.bttg-btn-dark-mode .bttg-is-moon{\n\t\t\tdisplay: none;\n\t\t}\n\t\t.bttg-btn-dark-mode .bttg-is-sun,\n\t\t.bttg-dark-mode .bttg-btn-dark-mode .bttg-is-moon{\n\t\t\tdisplay: inline-block;\n\t\t}\n\t\t.bttg-dark-mode body{\n\t\t\tbackground: var(--bttg-color-bg);\n\t\t\tcolor: var(--bttg-color-fc);\n\t\t}\n\t\t.bttg-dark-mode .top-bar{\n\t\t\tbackground: var(--bttg-color-bg);\n\t\t}\n\t\t.bttg-dark-mode .top-bar .menu ul li a {\n\t\t\tcolor: var(--bttg-color-fc);\n\t\t}\n\t\t.bttg-dark-mode .top-bar .header,\n\t\t.bttg-dark-mode .top-bar .header .wrapper-header .share,\n\t\t.bttg-dark-mode .top-bar .menu{\n\t\t\tborder-color: var(--bttg-color-bc);\n\t\t} \n\t\t.bttg-dark-mode .comments{\n\t\t\tborder-radius: 10px;\n\t\t\toverflow: hidden;\n\t\t}\n\t\t.bttg-dark-mode .page .no-data, \n\t\t.bttg-dark-mode .comments .comment, \n\t\t.bttg-dark-mode .comments.comments-user .comment .comment-wrapper{\n\t\t\tbackground: var(--bttg-color-fg);\n\t\t\tborder-color: var(--bttg-color-bc);\n\t\t}\n\t\t.bttg-dark-mode .comments .comment .comment-header a{\n\t\t\tcolor: #eeeeee;\n\t\t}\n\t\t.bttg-dark-mode .comments .comment .comment-header .comment-time b{\n\t\t\tbackground: rgba(50 100 150 / 0.4);\n\t\t}\n\t\t.bttg-dark-mode .btn-criar-alerta{\n\t\t\tbackground: var(--bttg-color-fg);\n\t\t\tfont-size: 0;\n\t\t\twidth: 30px;\n\t\t}\n\t\t.bttg-dark-mode .search-bar{\n\t\t\tbackground: var(--bttg-color-fg);\n\t\t\tborder-color: var(--bttg-color-fg);\n\t\t\tborder-radius: 10px;\n\t\t}\n\t\t.bttg-dark-mode .search-bar [type="text"]{\n\t\t\tbackground: none;\n\t\t\tcolor: #fff;\n\t\t}\n\t\t.bttg-dark-mode .promotions article{\n\t\t\tbackground: var(--bttg-color-fg);\n\t\t\tborder-radius: 10px;\n\t\t\tcolor: var(--bttg-color-fc);\n\t\t}\n\t\t.bttg-dark-mode .promotions article .description h3 a{\n\t\t\tcolor: #ccc;\n\t\t}\n\t\t.bttg-dark-mode .promotions article .description .price,\n\t\t.bttg-dark-mode .promotions article .options .option-other p, \n\t\t.bttg-dark-mode .promotions article .image p{\n\t\t\tcolor: #ccc;\n\t\t}\n\t\t.bttg-dark-mode .promotions article .image img{\n\t\t\tfilter: contrast(1);\n\t\t\tmix-blend-mode: multiply;\n\t\t}\n\t\t.bttg-dark-mode .load-more button{\n\t\t\tbackground: var(--bttg-color-fg);\n\t\t\tborder-radius: 10px;\n\t\t\tcolor: var(--bttg-color-fc);\n\t\t}\n\t\t.bttg-dark-mode footer{\n\t\t\tbackground: var(--bttg-color-bg);\n\t\t}\n\t\t.bttg-dark-mode .tribute-container ul{\n\t\t\tbackground: var(--bttg-color-bg);\n\t\t\tborder-color: var(--bttg-color-bg);\n\t\t}\n\t\t.bttg-dark-mode .tribute-container ul .highlight{\n\t\t\tbackground: var(--bttg-color-bc);\n\t\t}\n\t\t.comments .comment .comment-wrapper:hover .comment-header [data-bttg-user-block] {\n\t\t\tdisplay: block !important;\n\t\t}\n\t\t</style>';document.head.innerHTML+=n;try{var mySettings=JSON.parse(localStorage.getItem("bttg_mysettings")??JSON.stringify({}));mySettings={helped:!1,darkmode:!0,users:[],...mySettings},o.helped=mySettings.helped,o.darkmode=mySettings.darkmode,o.users=mySettings.users}catch(t){console.error(t)}const a=()=>o,r=({helped:t=null,darkmode:e=null,users:n=null,_callback:a=(()=>{}),autosave:r=!1}={helped:null,darkmode:null,users:null,_callback:()=>{},autosave:!1})=>{o.helped=null!==t?t:o.helped,o.darkmode=null!==e?e:o.darkmode,o.users=null!==n?n:o.users,r?s({_callback:a()}):a()},s=({_callback:t=(()=>{})}={_callback:()=>{}})=>{localStorage.setItem("bttg_mysettings",JSON.stringify(o))},c=()=>a().users,d=(t="")=>{const e=c();e.push(t),r({users:[...new Set(e)],autosave:!0,_callback:()=>{g()}})},i=(t="")=>{var e=c();e=e.filter((function(e){return e!==t})),r({users:[...new Set(e)],autosave:!0,_callback:()=>{setTimeout((()=>{console.log("Bye!"),window.location.reload()}),1e3)}})},l=()=>{document.getElementsByTagName("html")[0].classList.add("bttg-dark-mode")},g=()=>{const t=c();$(".comment-wrapper").each((function(){const o=$(this),n=o.find(".comment-header").first(),a=n.find("a").attr("href").toString().toString().toLowerCase().split("/").slice(-1)[0];if(t.includes(a)&&!window.location.href.toString().toLowerCase().includes(`detalhe/${a}`))return o.parent().remove(),null;if(o.find("[data-bttg-user-block]").length)return null;const r=$("<a>",{href:"#","data-bttg-user-block":a,css:{color:"coral",float:"right","margin-left":"7px",display:"none"},html:'<i class="fa fa-ban"></i>'}).on("click",(function(t){if(t.stopImmediatePropagation(),t.preventDefault(),"desireeoficial"==a)return alert("Eu crio o script e você tenta usar contra mim?"),alert("Imbecil."),null;d(a)})),s=o.find(".comment-report");if(r.insertBefore(s),e[a]){$("<img>",{src:`https://cdn.jsdelivr.net/gh/Gataquadrada/better-gatry@latest/assets/badge_${e[a]}.png`,css:{height:"15px",width:"15px"}}).insertBefore(n.find(".text-gray").first())}}))},b=()=>{var t=document.createElement("a");t.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(JSON.stringify(a()))),t.setAttribute("download","settings.bttg"),t.style.display="none",document.body.appendChild(t),t.click(),document.body.removeChild(t)},m=()=>new Promise(((t,e)=>{if("undefined"!=typeof FileReader){const o=$("<input/>",{type:"file",accept:".bttg"});o.on("change",(function(){const o=$(this),n=new FileReader;n.onload=function(o){try{const e=JSON.parse(o.target.result);t(e)}catch(t){e("Não foi possível carregar suas configurações...")}},n.readAsText(o[0].files[0])})),o.trigger("click")}else alert("Your system doesn't support offline file manipulation...")}));o.darkmode&&l(),window.addEventListener("load",(()=>{const e=$("<div>",{css:{"align-items":"center",display:"flex","flex-direction":"column",gap:"5px","justify-content":"center"}}).appendTo($("section.top-bar .header .container .wrapper-header")),o=$("<a>",{href:"#",css:{"align-items":"center",background:"#ff338b","border-radius":"100%",color:"white",display:"flex","font-size":"13px",height:"20px","justify-content":"center",opacity:".9",width:"20px"}}).on("click",(function(e){e.stopImmediatePropagation(),e.preventDefault();const o=setInterval((()=>{if($("[data-bttg-settings-window-container]").is(":visible")){const t=$("<div>",{"data-bttg-settings-window":!0}).appendTo($("[data-bttg-settings-window-container]"));t.on("click","[data-bttg-tab]",(function(t){t.stopImmediatePropagation(),t.preventDefault(),$("[data-bttg-tab]").removeClass("active"),$(this).addClass("active"),$("[data-bttg-tab-content]").addClass("d-none"),$(`[data-bttg-tab-content="${$(this).data("bttg-tab")}"]`).removeClass("d-none")}));const e=$("<div>",{class:"list-group"}).appendTo(t),n=$("<a>",{href:"#",class:"list-group-item list-group-item-action p-2 "+(mySettings.helped?"active":""),"data-bttg-tab":"settings-general",text:"Geral"}).appendTo(e),s=$("<div>",{text:"Você não possui usuários bloqueados."}),d=c();d.length&&(s.empty().append($("<h6>",{text:"Usuários bloqueados",css:{"font-weight":"600","font-size":"16px"}})),$.each(d,((t,e)=>{s.append($("<div>",{class:"form-group form-check"}).append($("<input>",{type:"checkbox",class:"form-check-input",id:`bttg-checkbox-${e}`,checked:!0}).on("change",(function(){i(e)}))).append($("<label >",{class:"form-check-label",for:`bttg-checkbox-${e}`,text:e})))})),s.children().last().addClass("m-0"));const l=$("<div>",{class:"d-none","data-bttg-tab-content":"settings-general"}).append(s),g=($("<a>",{href:"#",class:"list-group-item list-group-item-action p-2 "+(mySettings.helped?"":"active"),"data-bttg-tab":"settings-backup",text:"Backup"}).appendTo(e),$("<div>",{class:"d-none","data-bttg-tab-content":"settings-backup"}).append($("<button>",{type:"button",class:"btn btn-primary btn-block mb-3",text:"Salvar configurações"}).on("click",(function(t){t.stopImmediatePropagation(),t.preventDefault(),b()}))).append($("<button>",{type:"button",class:"btn btn-outline-danger btn-sm btn-block m-0",text:"Carregar configurações"}).on("click",(function(t){t.stopImmediatePropagation(),t.preventDefault();const e=$(this);m().then((t=>{e.addClass("disabled"),r({helped:t.helped??!1,darkmode:t.darkmode??!1,users:t.users??[],autosave:!0,_callback:()=>{setTimeout((()=>{console.log("Bye!"),window.location.reload()}),1e3)}})})).catch((t=>{e.removeClass("disabled"),alert(t)}))})))),p=$("<a>",{href:"#",class:"list-group-item list-group-item-action p-2 "+(mySettings.helped?"":"active"),"data-bttg-tab":"settings-help",text:"Ajuda"}).appendTo(e),u=$("<div>",{class:"d-none","data-bttg-tab-content":"settings-help"}).append($("<p>",{html:'- Clique em (<i class="fab fa-simplybuilt"></i>) para abrir este menu.'})).append($("<p>",{text:'- Posicione o mouse sobre um comentário, para exibir os botões "Reportar" e "Bloquear".'})).append($("<p>",{text:"- As configurações serão salvas no seu navegador (e somente ele)."})).append($("<p>",{text:"- Se você gostou da iniciativa, agradeça não sendo um completo imbecil."})).append($("<p>",{html:'- Sugestões? <a href="https://gatry.com/usuarios/detalhe/desireeoficial">Meu perfil</a>.',class:"m-0"}));t.append($("<div>",{class:"row no-gutters"}).append($("<div>",{class:"col-12 col-md-4 pr-md-2 mt-2"}).append(e)).append($("<div>",{class:"col-12 col-md-8 mt-2"}).append($("<div>",{class:"border rounded p-2",css:{"font-size":"14px","text-align":" left"}}).append(l).append(g).append(u)))),a().helped?n.trigger("click"):(p.trigger("click"),r({helped:!0,autosave:!0})),clearInterval(o)}}),100);Swal.fire({title:`Better Gatry ${t}`,html:'<div data-bttg-settings-window-container="true"></div>',type:null})})).appendTo(e).append($("<i>",{class:"fab fa-simplybuilt"}));a().helped||o.trigger("click");$("<a>",{href:"#",class:"bttg-btn-dark-mode",css:{"align-items":"center","border-radius":"100%",color:"white",display:"flex","font-size":"10px",height:"20px","justify-content":"center",opacity:".9",width:"20px"}}).on("click",(function(t){t.stopImmediatePropagation(),t.preventDefault(),$("html").toggleClass("bttg-dark-mode"),r({darkmode:!a().darkmode,autosave:!0})})).append($("<i>",{class:"fa fa-star bttg-is-sun"})).append($("<i>",{class:"fa fa-moon bttg-is-moon"})).appendTo(e);g(),$(document).off("click","[data-lightbox-comments]"),$(document).on("click","[data-lightbox-comments]",(function(t){t.stopImmediatePropagation(),t.preventDefault();var e=$(this).prop("href");new Fancybox([{type:"ajax",src:e}],{mainClass:"fancybox-gatry fancybox-gatry-comment",on:{loaded:g,ready:g,done:g}})}));var n=!1,s=!1;$(".load-more button").off("click"),$(document).on("click",".load-more button",(function(t){if(t.stopImmediatePropagation(),t.preventDefault(),s=!0,!n){n=!0;var e=$(this),o=$(this).data("url"),a=$(this).data("appendLocal"),r=$(this).data("finishText")||"Todos os registros foram exibidos",c=$(this).data("exclude")||null,d=parseInt($(this).data("currentPage"))+1,i=document.documentElement.scrollTop;e.html("Carregando, aguarde..."),$.get(o,{page:d,exclude:c},(function(t){if(0==t.length)return e.prop("disabled",!0),s=!1,void e.html(r);$(t).each((function(){const t=$(this);if($(this).find(".description h3").length){const e=$(this).find(".description h3").text();$(`article:contains("${e}")`).length||$(a).append(t)}else if($(this).find(".comment-content").length){const e=$(this).find(".comment-content").text();$(`.comment:contains("${e}")`).length||$(a).append(t)}})),e.data("currentPage",d),window.scrollTo(0,i),n=!1,e.html("Carregar mais..."),g()}))}})),$(window).on("scroll",(function(t){(s||$.browser.mobile)&&0!=$(".load-more button").length&&$(window).scrollTop()>=$(document).height()-$(window).height()-10&&$(".load-more button").click()}))}))}