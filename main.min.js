// ==UserScript==
// @name        Better Gatry
// @description Make Gatry great.
// @match       *://gatry.com/*
// ==/UserScript==

const bttgDarkModeStyles='<style id="bttg-dark-mode">\n\t:root{\n\t\t--bttg-color-bg: #222831;\n\t\t--bttg-color-fg: #393E46;\n\t\t--bttg-color-bc: #343a40;\n\t\t--bttg-color-fc: #cccccc;\n\t\t--fancybox-content-bg: var(--bttg-color-fg);\n\t\t--fancybox-content-color: var(--bttg-color-fc);\n\t}\n\t.bttg-btn-dark-mode{\n\t\tbackground: #f27474;\n\t}\n\t.bttg-dark-mode .bttg-btn-dark-mode{\n\t\tbackground: #495057;\n\t}\n\t.bttg-dark-mode .bttg-btn-dark-mode .fa-sun,\n\t.bttg-btn-dark-mode .fa-moon{\n\t\tdisplay: none;\n\t}\n\t.bttg-btn-dark-mode .fa-sun,\n\t.bttg-dark-mode .bttg-btn-dark-mode .fa-moon{\n\t\tdisplay: inline-block;\n\t}\n\t.bttg-dark-mode body{\n\t\tbackground: var(--bttg-color-bg);\n\t\tcolor: var(--bttg-color-fc);\n\t}\n\t.bttg-dark-mode .top-bar{\n\t\tbackground: var(--bttg-color-bg);\n\t}\n\t.bttg-dark-mode .top-bar .menu ul li a {\n\t\tcolor: var(--bttg-color-fc);\n\t}\n\t.bttg-dark-mode .top-bar .header,\n\t.bttg-dark-mode .top-bar .header .wrapper-header .share,\n\t.bttg-dark-mode .top-bar .menu{\n\t\tborder-color: var(--bttg-color-bc);\n\t}\n\t.bttg-dark-mode .page .no-data, \n\t.bttg-dark-mode .comments .comment, \n\t.bttg-dark-mode .comments.comments-user .comment .comment-wrapper{\n\t\tbackground: var(--bttg-color-fg);\n\t\tborder-color: var(--bttg-color-bc);\n\t}\n\t.bttg-dark-mode .comments .comment .comment-header a{\n\t\tcolor: #eeeeee;\n\t}\n\t.bttg-dark-mode .comments .comment .comment-header .comment-time b{\n\t\tbackground: rgba(50 100 150 / 0.4);\n\t}\n\t.bttg-dark-mode .btn-criar-alerta{\n\t\tbackground: var(--bttg-color-fg);\n\t\tfont-size: 0;\n\t\twidth: 30px;\n\t}\n\t.bttg-dark-mode .search-bar{\n\t\tbackground: var(--bttg-color-fg);\n\t\tborder-color: var(--bttg-color-fg);\n\t\tborder-radius: 10px;\n\t}\n\t.bttg-dark-mode .search-bar [type="text"]{\n\t\tbackground: none;\n\t\tcolor: #fff;\n\t}\n\t.bttg-dark-mode .promotions article{\n\t\tbackground: var(--bttg-color-fg);\n\t\tborder-radius: 10px;\n\t\tcolor: var(--bttg-color-fc);\n\t}\n\t.bttg-dark-mode .promotions article .description h3 a{\n\t\tcolor: #ccc;\n\t}\n\t.bttg-dark-mode .promotions article .description .price,\n\t.bttg-dark-mode .promotions article .options .option-other p, \n\t.bttg-dark-mode .promotions article .image p{\n\t\tcolor: #ccc;\n\t}\n\t.bttg-dark-mode .promotions article .image img{\n\t\tfilter: contrast(1);\n\t\tmix-blend-mode: multiply;\n\t}\n\t.bttg-dark-mode .load-more button{\n\t\tbackground: var(--bttg-color-fg);\n\t\tborder-radius: 10px;\n\t\tcolor: var(--bttg-color-fc);\n\t}\n\t.bttg-dark-mode footer{\n\t\tbackground: var(--bttg-color-bg);\n\t}\n\t</style>';document.head.innerHTML+=bttgDarkModeStyles;const bttgDarkmodeOn=()=>{document.getElementsByTagName("html")[0].classList.add("bttg-dark-mode")},bttgDarkmodeOff=()=>{document.getElementsByTagName("html")[0].classList.remove("bttg-dark-mode")},bttgGetSettings=()=>{const t={helped:!1,darkmode:!0,users:[]};try{const e=JSON.parse(localStorage.getItem("bttg_mysettings")??JSON.stringify({}));return{...t,...e}}catch(e){return console.error(e),t}},bttgSetSettings=({helped:t=null,darkmode:e=null,users:o=null}={helped:null,darkmode:null,users:null})=>{const n=bttgGetSettings();n.helped=null!==t?t:n.helped,n.darkmode=null!==e?e:n.darkmode,n.users=null!==o?o:n.users,localStorage.setItem("bttg_mysettings",JSON.stringify(n))},bttgGetBlocked=()=>bttgGetSettings().users,bttgDoBlock=(t="")=>{const e=bttgGetBlocked();e.push(t),bttgSetSettings({users:[...new Set(e)]}),bttgCleanThem()},bttgDoUnblock=(t="")=>{var e=bttgGetBlocked();e=e.filter((function(e){return e!==t})),bttgSetSettings({users:[...new Set(e)]}),window.location.reload()},bttgCleanThem=()=>{const t=bttgGetBlocked();$(".comment-wrapper").each((function(){const e=$(this),o=e.find(".comment-header").first().find("a").attr("href").toString().toLowerCase().split("/").slice(-1)[0];if(t.includes(o)&&!window.location.href.toString().toLowerCase().includes(`detalhe/${o}`))return e.parent().remove(),null;if(e.find("[data-bttg-user-block]").length)return null;const n=$("<a>",{href:"#","data-bttg-user-block":o,css:{color:"coral",float:"right","margin-left":"7px"},html:'<i class="fa fa-ban"></i>'}).hide(),a=e.find(".comment-report");n.insertBefore(a)}))};bttgGetSettings().darkmode&&document.getElementsByTagName("html")[0].classList.add("bttg-dark-mode");window.addEventListener("load",(()=>{const t=bttgGetSettings(),e=$("<div>",{css:{"align-items":"center",display:"flex","flex-direction":"column",gap:"5px","justify-content":"center"}}).appendTo($("section.top-bar .header .container .wrapper-header")),o=$("<a>",{href:"#",css:{"align-items":"center",background:"#ff338b","border-radius":"100%",color:"white",display:"flex","font-size":"10px",height:"20px","justify-content":"center",opacity:".9",width:"20px"}}).append($("<i>",{class:"fa fa-question"}));o.on("click",(function(t){t.stopImmediatePropagation(),t.preventDefault(),Swal.fire({title:"Better Gatry 0.0.1",text:"Teste",html:`\n\t\t\t<ul style="font-size:16px;text-align:left;list-style:disc;padding-left:15px;">\n\t\t\t\t<li style="margin-bottom:5px">Passe o mouse em um comentário, para exibir o botão de bloquear.</li>\n\t\t\t\t<li style="margin-bottom:5px">Clique na (<i class="fa fa-question"></i>) no seu avatar para abrir essa janela.</li>\n\t\t\t</ul>\n\t\t\t<div style="margin:5px 0 10px 0;padding:20px;background:rgba(0 123 255 / .25);border-radius:10px;">\n\t\t\t\t<label>Bloqueados</label>\n\t\t\t\t<ul style="margin:0">\n\t\t\t\t\t${bttgGetBlocked().length?bttgGetBlocked().map(((t,e)=>`<li style="font-size:18px" data-bttg-user-unblock="${t}">${t}<a href="#" style="margin-left:5px;color:green"><i class="fa fa-check"></i></a></li>`)).join(""):'<li style="font-size:14px" bttg-users-blocked-none="true">Nenhum!</li>'}\n\t\t\t\t</ul>\n\t\t\t</div>\n\t\t\t<p><small>Por <strong>*a*</strong> <a href="https://gatry.com/usuarios/detalhe/desireeoficial">Desiree</a></small></p>`,type:"info"}),bttgSetSettings({helped:!0})})),e.append(o),t.helped||o.trigger("click");const n=$("<a>",{href:"#",class:"bttg-btn-dark-mode",css:{"align-items":"center","border-radius":"100%",color:"white",display:"flex","font-size":"10px",height:"20px","justify-content":"center",opacity:".9",width:"20px"}}).append($("<i>",{class:"fa fa-sun"})).append($("<i>",{class:"fa fa-moon"}));n.on("click",(function(e){e.stopImmediatePropagation(),e.preventDefault(),$("html").toggleClass("bttg-dark-mode"),bttgSetSettings({darkmode:!t.darkmode})})),e.append(n),bttgCleanThem(),$(document).off("click","[data-lightbox-comments]"),$(document).on("click","[data-lightbox-comments]",(function(t){t.stopImmediatePropagation(),t.preventDefault();var e=$(this).prop("href");new Fancybox([{type:"ajax",src:e}],{mainClass:"fancybox-gatry fancybox-gatry-comment",on:{loaded:bttgCleanThem,ready:bttgCleanThem,done:bttgCleanThem}})})),$(".load-more button").off("click");var a=!1,r=!1;$(document).on("click",".load-more button",(function(t){if(t.stopImmediatePropagation(),t.preventDefault(),r=!0,!a){a=!0;var e=$(this),o=$(this).data("url"),n=$(this).data("appendLocal"),l=$(this).data("finishText")||"Todos os registros foram exibidos",d=$(this).data("exclude")||null,c=parseInt($(this).data("currentPage"))+1,i=document.documentElement.scrollTop;e.html("Carregando, aguarde..."),$.get(o,{page:c,exclude:d},(function(t){if(0==t.length)return e.prop("disabled",!0),r=!1,void e.html(l);$(n).append(t),e.data("currentPage",c),window.scrollTo(0,i),a=!1,e.html("Carregar mais..."),bttgCleanThem()}))}})),$(window).on("scroll",(function(t){(r||$.browser.mobile)&&0!=$(".load-more button").length&&$(window).scrollTop()>=$(document).height()-$(window).height()-10&&$(".load-more button").click()})),$(document).on("click","[data-bttg-user-block]",(function(t){t.stopImmediatePropagation(),t.preventDefault();const e=$(this).data("bttg-user-block");if("desireeoficial"==e)return alert("Eu crio o script e você tenta usar contra mim?"),alert("Imbecil."),null;bttgDoBlock(e),$("[bttg-users-blocked-none]").remove()})),$(document).on("click","[data-bttg-user-unblock]",(function(t){t.stopImmediatePropagation(),t.preventDefault();const e=$(this).data("bttg-user-unblock");bttgDoUnblock(e),$(`[data-bttg-user-unblock="${e}"]`).remove()})),$("body").append("<style>\n\t.comments .comment .comment-wrapper:hover .comment-header [data-bttg-user-block] {display: block !important;}\n\t</style>")}));